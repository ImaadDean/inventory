{% extends "base.html" %}

{% block title %}Suppliers - Inventory Management System{% endblock %}

{% block content %}
<div class="space-y-4 animate-fade-in">
    <!-- Header -->
    <div class="bg-gradient-to-r from-orange-500 to-red-600 shadow-lg rounded-xl p-4 text-white">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="mb-2 md:mb-0">
                <h1 class="text-xl md:text-2xl font-bold">Supplier Management</h1>
                <p class="text-orange-100 text-sm">Manage your suppliers and vendor relationships</p>
            </div>
            <button onclick="openAddSupplierModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all duration-200 text-sm">
                <i class="fas fa-plus"></i>
                <span class="font-medium">Add Supplier</span>
            </button>
            <button onclick="syncSupplierProducts()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all duration-200 text-sm">
                <i class="fas fa-sync"></i>
                <span class="font-medium">Sync Products</span>
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
        <!-- Total Suppliers -->
        <div class="bg-white overflow-hidden shadow-md rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div class="p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-400 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
                            <i class="fas fa-truck text-white text-xs"></i>
                        </div>
                    </div>
                    <div class="ml-3 flex-1">
                        <dt class="text-xs font-medium text-gray-500 truncate">Total Suppliers</dt>
                        <dd class="text-base font-bold text-gray-900 mt-0.5" id="total-suppliers">0</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-4 py-2">
                <div class="text-xs">
                    <span class="text-blue-700 font-medium">Registered suppliers</span>
                </div>
            </div>
        </div>

        <!-- Active Suppliers -->
        <div class="bg-white overflow-hidden shadow-md rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div class="p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-400 to-green-600 rounded-lg flex items-center justify-center shadow-md">
                            <i class="fas fa-check-circle text-white text-xs"></i>
                        </div>
                    </div>
                    <div class="ml-3 flex-1">
                        <dt class="text-xs font-medium text-gray-500 truncate">Active Suppliers</dt>
                        <dd class="text-base font-bold text-gray-900 mt-0.5" id="active-suppliers">0</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-green-50 to-green-100 px-4 py-2">
                <div class="text-xs">
                    <span class="text-green-700 font-medium">Currently active</span>
                </div>
            </div>
        </div>

        <!-- Total Products -->
        <div class="bg-white overflow-hidden shadow-md rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div class="p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-400 to-purple-600 rounded-lg flex items-center justify-center shadow-md">
                            <i class="fas fa-boxes text-white text-xs"></i>
                        </div>
                    </div>
                    <div class="ml-3 flex-1">
                        <dt class="text-xs font-medium text-gray-500 truncate">Products Supplied</dt>
                        <dd class="text-base font-bold text-gray-900 mt-0.5" id="supplied-products">0</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-purple-50 to-purple-100 px-4 py-2">
                <div class="text-xs">
                    <span class="text-purple-700 font-medium">Total products</span>
                </div>
            </div>
        </div>

        <!-- Total Value -->
        <div class="bg-white overflow-hidden shadow-md rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <div class="p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center shadow-md">
                            <i class="fas fa-dollar-sign text-white text-xs"></i>
                        </div>
                    </div>
                    <div class="ml-3 flex-1">
                        <dt class="text-xs font-medium text-gray-500 truncate">Total Value</dt>
                        <dd class="text-base font-bold text-gray-900 mt-0.5" id="total-value">UGX 0</dd>
                    </div>
                </div>
            </div>
            <div class="bg-gradient-to-r from-yellow-50 to-orange-100 px-4 py-2">
                <div class="text-xs">
                    <span class="text-orange-700 font-medium">Inventory value</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Suppliers Table -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-all duration-300">
        <!-- Table Header with Search & Filters -->
        <div class="px-4 py-3 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-3 lg:space-y-0">
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center mr-2">
                        <i class="fas fa-table text-white text-xs"></i>
                    </div>
                    <h3 class="text-base font-semibold text-gray-900">Supplier Directory</h3>
                </div>

                <!-- Compact Search & Filter Controls -->
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                    <div class="relative">
                        <input type="text" id="search-suppliers" placeholder="Search suppliers..."
                               class="pl-7 pr-3 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent w-full sm:w-40 text-xs transition-all duration-200">
                        <i class="fas fa-search absolute left-2 top-2 text-gray-400 text-xs"></i>
                    </div>
                    <select id="status-filter" class="px-2 py-1.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-xs transition-all duration-200">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <div class="flex space-x-1">
                        <button onclick="loadSuppliers()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1.5 rounded-lg flex items-center space-x-1 text-xs transition-all duration-200">
                            <i class="fas fa-refresh text-xs"></i>
                            <span>Refresh</span>
                        </button>
                        <button onclick="exportSuppliers()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1.5 rounded-lg flex items-center space-x-1 text-xs transition-all duration-200">
                            <i class="fas fa-download text-xs"></i>
                            <span>Export</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Supplier</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Contact</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Products</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Last Order</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="suppliers-table-body" class="bg-white divide-y divide-gray-100">
                    <!-- Suppliers will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Supplier Modal -->
<div id="add-supplier-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full transform transition-all duration-300">
            <div class="px-4 py-3 bg-gradient-to-r from-orange-500 to-red-600 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-2">
                            <i class="fas fa-plus text-white text-xs"></i>
                        </div>
                        <h3 class="text-base font-semibold text-white">Add New Supplier</h3>
                    </div>
                    <button type="button" onclick="closeAddSupplierModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
            <form id="add-supplier-form" class="p-4 space-y-3">
                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-building text-gray-400 mr-1"></i>Company Name
                    </label>
                    <input type="text" name="name" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Enter company name">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-semibold text-gray-700 mb-1">
                            <i class="fas fa-user text-gray-400 mr-1"></i>Contact Person
                        </label>
                        <input type="text" name="contact_person" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Contact person name">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-700 mb-1">
                            <i class="fas fa-phone text-gray-400 mr-1"></i>Phone Number
                        </label>
                        <input type="tel" name="phone" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Phone number">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-envelope text-gray-400 mr-1"></i>Email Address
                    </label>
                    <input type="email" name="email" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Email address">
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-map-marker-alt text-gray-400 mr-1"></i>Address
                    </label>
                    <textarea name="address" rows="2" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Full address"></textarea>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-sticky-note text-gray-400 mr-1"></i>Notes
                    </label>
                    <textarea name="notes" rows="2" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200" placeholder="Additional notes"></textarea>
                </div>

                <div class="flex items-center p-3 bg-orange-50 rounded-lg border border-orange-200">
                    <input type="checkbox" name="is_active" checked class="h-3 w-3 text-orange-600 focus:ring-orange-500 border-gray-300 rounded">
                    <label class="ml-2 block text-xs font-medium text-orange-900">
                        <i class="fas fa-check-circle text-orange-600 mr-1"></i>Active Supplier
                    </label>
                    <span class="ml-2 text-xs text-orange-600">Supplier is available for orders</span>
                </div>

                <div class="flex justify-end space-x-2 pt-3 border-t border-gray-200">
                    <button type="button" onclick="closeAddSupplierModal()" class="px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200">
                        Cancel
                    </button>
                    <button type="submit" class="px-3 py-2 text-xs font-medium text-white bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg">
                        <i class="fas fa-plus mr-1"></i>Add Supplier
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Supplier Modal -->
<div id="edit-supplier-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full transform transition-all duration-300 max-h-[90vh] overflow-y-auto">
            <div class="px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-2">
                            <i class="fas fa-edit text-white text-xs"></i>
                        </div>
                        <h3 class="text-base font-semibold text-white">Edit Supplier</h3>
                    </div>
                    <button type="button" onclick="closeEditSupplierModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
            <form id="edit-supplier-form" class="p-4 space-y-4">
                <input type="hidden" id="edit-supplier-id">

                <!-- Supplier Info Header -->
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-sm font-semibold text-gray-900">Editing Supplier</h4>
                            <p class="text-xs text-gray-600 mt-1">
                                <span id="edit-supplier-info">Loading supplier information...</span>
                            </p>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-500">Products</div>
                            <div class="text-sm font-semibold text-blue-600" id="edit-supplier-product-count">0</div>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-2">
                        <i class="fas fa-building text-gray-400 mr-1"></i>Company Name
                    </label>
                    <input type="text" id="edit-name" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-400" placeholder="Enter company name">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-gray-700 mb-2">
                            <i class="fas fa-user text-gray-400 mr-1"></i>Contact Person
                        </label>
                        <input type="text" id="edit-contact-person" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-400" placeholder="Contact person name">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-700 mb-2">
                            <i class="fas fa-phone text-gray-400 mr-1"></i>Phone Number
                        </label>
                        <input type="tel" id="edit-phone" required class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-400" placeholder="Phone number">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-envelope text-gray-400 mr-1"></i>Email Address
                    </label>
                    <input type="email" id="edit-email" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Email address">
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-map-marker-alt text-gray-400 mr-1"></i>Address
                    </label>
                    <textarea id="edit-address" rows="2" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Full address"></textarea>
                </div>

                <div>
                    <label class="block text-xs font-semibold text-gray-700 mb-1">
                        <i class="fas fa-sticky-note text-gray-400 mr-1"></i>Notes
                    </label>
                    <textarea id="edit-notes" rows="2" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Additional notes"></textarea>
                </div>

                <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <input type="checkbox" id="edit-is-active" class="h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label class="ml-2 block text-xs font-medium text-blue-900">
                        <i class="fas fa-check-circle text-blue-600 mr-1"></i>Active Supplier
                    </label>
                    <span class="ml-2 text-xs text-blue-600">Supplier is available for orders</span>
                </div>

                <div class="flex justify-end space-x-2 pt-3 border-t border-gray-200">
                    <button type="button" onclick="closeEditSupplierModal()" class="px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200">
                        Cancel
                    </button>
                    <button type="submit" class="px-3 py-2 text-xs font-medium text-white bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg">
                        <i class="fas fa-save mr-1"></i>Update Supplier
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Supplier Modal -->
<div id="delete-supplier-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full transform transition-all duration-300">
            <div class="px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-2">
                            <i class="fas fa-exclamation-triangle text-white text-xs"></i>
                        </div>
                        <h3 class="text-base font-semibold text-white">Delete Supplier</h3>
                    </div>
                    <button type="button" onclick="closeDeleteSupplierModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
            <div class="p-4">
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-red-600 text-lg"></i>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-sm font-semibold text-gray-900 mb-2">Are you sure you want to delete this supplier?</h4>
                        <div class="text-xs text-gray-600 space-y-2">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <div class="flex items-start">
                                    <i class="fas fa-info-circle text-yellow-600 text-xs mt-0.5 mr-2"></i>
                                    <div>
                                        <p class="font-medium text-yellow-800 text-xs">Supplier Information:</p>
                                        <p class="text-yellow-700 text-xs mt-1">
                                            <strong>Name:</strong> <span id="delete-supplier-name">-</span><br>
                                            <strong>Contact:</strong> <span id="delete-supplier-contact">-</span><br>
                                            <strong>Products:</strong> <span id="delete-supplier-products">0</span> products
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div class="flex items-start">
                                    <i class="fas fa-shield-alt text-blue-600 text-xs mt-0.5 mr-2"></i>
                                    <div>
                                        <p class="font-medium text-blue-800 text-xs">Product Preservation:</p>
                                        <p class="text-blue-700 text-xs mt-1">
                                            All products supplied by this supplier will be <strong>kept in the system</strong>.
                                            They will be marked as <code class="bg-blue-100 px-1 rounded">[DELETED] Supplier Name</code>
                                            to preserve history and maintain data integrity.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-red-600 text-xs mt-0.5 mr-2"></i>
                                    <div>
                                        <p class="font-medium text-red-800 text-xs">Warning:</p>
                                        <p class="text-red-700 text-xs mt-1">
                                            This action cannot be undone. The supplier will be permanently removed from the system.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-2 mt-4 pt-3 border-t border-gray-200">
                    <button type="button" onclick="closeDeleteSupplierModal()" class="px-4 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200">
                        <i class="fas fa-times mr-1"></i>Cancel
                    </button>
                    <button type="button" onclick="confirmDeleteSupplier()" class="px-4 py-2 text-xs font-medium text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg">
                        <i class="fas fa-trash mr-1"></i>Delete Supplier
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- View Supplier Modal -->
<div id="view-supplier-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full transform transition-all duration-300 max-h-[90vh] overflow-y-auto">
            <!-- Header -->
            <div class="px-4 py-3 bg-gradient-to-r from-orange-500 to-red-600 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-building text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-white" id="view-supplier-name">Loading...</h3>
                            <p class="text-orange-100 text-sm" id="view-supplier-contact">Loading contact...</p>
                        </div>
                    </div>
                    <button onclick="closeViewSupplierModal()" class="text-white hover:text-orange-200 transition-colors duration-200 p-1 hover:bg-white hover:bg-opacity-10 rounded">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="p-4 space-y-4">
                <!-- Quick Stats -->
                <div class="grid grid-cols-4 gap-3">
                    <div class="bg-purple-50 rounded-lg p-3 border border-purple-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center mr-2">
                                <i class="fas fa-boxes text-white text-xs"></i>
                            </div>
                            <div>
                                <div class="text-xs font-semibold text-purple-600">Products</div>
                                <div class="text-lg font-bold text-purple-900" id="view-supplier-products">0</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center mr-2">
                                <i class="fas fa-calendar-alt text-white text-xs"></i>
                            </div>
                            <div>
                                <div class="text-xs font-semibold text-blue-600">Last Order</div>
                                <div class="text-sm font-bold text-blue-900" id="view-supplier-last-order">Never</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-green-50 rounded-lg p-3 border border-green-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-2">
                                <i class="fas fa-check-circle text-white text-xs"></i>
                            </div>
                            <div>
                                <div class="text-xs font-semibold text-green-600">Status</div>
                                <div id="view-supplier-status">
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium">
                                        <i class="fas fa-circle text-xs mr-1"></i>
                                        Loading...
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-yellow-500 rounded-lg flex items-center justify-center mr-2">
                                <i class="fas fa-shopping-cart text-white text-xs"></i>
                            </div>
                            <div>
                                <div class="text-xs font-semibold text-yellow-600">Orders</div>
                                <div class="text-lg font-bold text-yellow-900" id="view-supplier-total-orders">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <!-- Left Column: Contact & Info -->
                    <div class="space-y-4">
                        <!-- Contact Information -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-address-book text-gray-500 mr-2"></i>
                                Contact Information
                            </h4>
                            <div class="space-y-2">
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-phone text-blue-600 w-4 mr-2"></i>
                                    <span class="text-gray-600 w-12">Phone:</span>
                                    <span class="font-medium text-gray-900" id="view-supplier-phone">-</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-envelope text-green-600 w-4 mr-2"></i>
                                    <span class="text-gray-600 w-12">Email:</span>
                                    <span class="font-medium text-gray-900" id="view-supplier-email">-</span>
                                </div>
                                <div class="flex items-start text-sm">
                                    <i class="fas fa-map-marker-alt text-red-600 w-4 mr-2 mt-0.5"></i>
                                    <span class="text-gray-600 w-12">Address:</span>
                                    <span class="font-medium text-gray-900" id="view-supplier-address">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Account Details -->
                        <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-200">
                            <h4 class="text-sm font-semibold text-indigo-900 mb-3 flex items-center">
                                <i class="fas fa-user-tie text-indigo-600 mr-2"></i>
                                Account Details
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-indigo-700">Created:</span>
                                    <span class="font-medium text-indigo-900" id="view-supplier-created">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-indigo-700">Updated:</span>
                                    <span class="font-medium text-indigo-900" id="view-supplier-updated">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="bg-gray-50 rounded-lg p-4" id="view-supplier-notes-section">
                            <h4 class="text-sm font-semibold text-gray-900 mb-2 flex items-center">
                                <i class="fas fa-sticky-note text-gray-500 mr-2"></i>
                                Notes
                            </h4>
                            <div class="text-sm text-gray-700" id="view-supplier-notes">No additional notes available.</div>
                        </div>
                    </div>

                    <!-- Right Column: Products -->
                    <div class="space-y-4">
                        <!-- Products List -->
                        <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                            <h4 class="text-sm font-semibold text-purple-900 mb-3 flex items-center justify-between">
                                <span>
                                    <i class="fas fa-boxes text-purple-600 mr-2"></i>
                                    Supplied Products
                                </span>
                                <span class="text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full" id="view-supplier-products-count">0 products</span>
                            </h4>
                            <div class="max-h-64 overflow-y-auto">
                                <div id="view-supplier-products-list" class="space-y-2">
                                    <div class="text-sm text-purple-700 text-center py-4">Loading products...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-end space-x-2 pt-3 border-t border-gray-200">
                    <button onclick="closeViewSupplierModal()" class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200">
                        Close
                    </button>
                    <button onclick="editSupplierFromView()" class="px-3 py-2 text-sm font-medium text-white bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
// Supplier management functionality
function openAddSupplierModal() {
    document.getElementById('add-supplier-modal').classList.remove('hidden');
}

function closeAddSupplierModal() {
    document.getElementById('add-supplier-modal').classList.add('hidden');
    document.getElementById('add-supplier-form').reset();
}

function openEditSupplierModal() {
    document.getElementById('edit-supplier-modal').classList.remove('hidden');
}

function closeEditSupplierModal() {
    document.getElementById('edit-supplier-modal').classList.add('hidden');
    document.getElementById('edit-supplier-form').reset();
}

function openDeleteSupplierModal() {
    document.getElementById('delete-supplier-modal').classList.remove('hidden');
}

function closeDeleteSupplierModal() {
    document.getElementById('delete-supplier-modal').classList.add('hidden');
    // Clear the stored supplier ID
    window.deleteSupplierData = null;
}

// Keyboard shortcuts for modals
document.addEventListener('keydown', function(e) {
    // Close modals with Escape key
    if (e.key === 'Escape') {
        const editModal = document.getElementById('edit-supplier-modal');
        const deleteModal = document.getElementById('delete-supplier-modal');
        const addModal = document.getElementById('add-supplier-modal');

        if (!editModal.classList.contains('hidden')) {
            closeEditSupplierModal();
        } else if (!deleteModal.classList.contains('hidden')) {
            closeDeleteSupplierModal();
        } else if (!addModal.classList.contains('hidden')) {
            closeAddSupplierModal();
        }
    }

    // Confirm delete with Enter key when delete modal is open
    if (e.key === 'Enter' && !document.getElementById('delete-supplier-modal').classList.contains('hidden')) {
        e.preventDefault();
        confirmDeleteSupplier();
    }
});

// Close modals when clicking outside
document.addEventListener('click', function(e) {
    const editModal = document.getElementById('edit-supplier-modal');
    const deleteModal = document.getElementById('delete-supplier-modal');
    const addModal = document.getElementById('add-supplier-modal');

    if (e.target === editModal) {
        closeEditSupplierModal();
    } else if (e.target === deleteModal) {
        closeDeleteSupplierModal();
    } else if (e.target === addModal) {
        closeAddSupplierModal();
    }
});

// Handle Add Supplier Form Submission
document.getElementById('add-supplier-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(e.target);
    const supplierData = {
        name: formData.get('name'),
        contact_person: formData.get('contact_person'),
        phone: formData.get('phone'),
        email: formData.get('email') || null,
        address: formData.get('address') || null,
        notes: formData.get('notes') || null,
        is_active: formData.get('is_active') === 'on'
    };

    try {
        const response = await fetch('/api/suppliers/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify(supplierData)
        });

        if (response.ok) {
            const result = await response.json();
            showToast('Supplier added successfully!', 'success');
            closeAddSupplierModal();
            loadSuppliers();
        } else {
            const error = await response.json();
            showToast(error.detail || 'Failed to add supplier', 'error');
        }
    } catch (error) {
        console.error('Error adding supplier:', error);
        showToast('Failed to add supplier', 'error');
    }
});

// Handle Edit Supplier Form Submission
document.getElementById('edit-supplier-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const supplierId = document.getElementById('edit-supplier-id').value;
    const supplierData = {
        name: document.getElementById('edit-name').value,
        contact_person: document.getElementById('edit-contact-person').value,
        phone: document.getElementById('edit-phone').value,
        email: document.getElementById('edit-email').value || null,
        address: document.getElementById('edit-address').value || null,
        notes: document.getElementById('edit-notes').value || null,
        is_active: document.getElementById('edit-is-active').checked
    };

    try {
        const response = await fetch(`/api/suppliers/${supplierId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify(supplierData)
        });

        if (response.ok) {
            const result = await response.json();
            showToast(result.message || 'Supplier updated successfully!', 'success');
            closeEditSupplierModal();
            loadSuppliers();
        } else {
            const error = await response.json();
            showToast(error.detail || 'Failed to update supplier', 'error');
        }
    } catch (error) {
        console.error('Error updating supplier:', error);
        showToast('Failed to update supplier', 'error');
    }
});



function displaySuppliers(suppliers) {
    const tbody = document.getElementById('suppliers-table-body');
    
    if (suppliers.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                    <div class="flex flex-col items-center">
                        <i class="fas fa-truck text-4xl text-gray-300 mb-4"></i>
                        <p class="text-lg font-medium">No suppliers found</p>
                        <p class="text-sm">Add your first supplier to get started</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    tbody.innerHTML = suppliers.map(supplier => `
        <tr class="hover:bg-gray-50 transition-colors duration-200">
            <td class="px-3 py-3 whitespace-nowrap">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gradient-to-r from-orange-400 to-red-500 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-building text-white text-xs"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-900">${supplier.name}</div>
                        <div class="text-xs text-gray-500">${supplier.contact_person || 'No contact'}</div>
                    </div>
                </div>
            </td>
            <td class="px-3 py-3 whitespace-nowrap">
                <div class="text-sm text-gray-900">${supplier.phone || 'N/A'}</div>
                <div class="text-xs text-gray-500">${supplier.email || 'No email'}</div>
            </td>
            <td class="px-3 py-3 whitespace-nowrap">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    ${supplier.products_count || 0} products
                </span>
            </td>
            <td class="px-3 py-3 whitespace-nowrap">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${supplier.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                    <i class="fas fa-circle text-xs mr-1"></i>
                    ${supplier.is_active ? 'Active' : 'Inactive'}
                </span>
            </td>
            <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500">
                ${supplier.last_order_date ? new Date(supplier.last_order_date).toLocaleDateString() : 'Never'}
            </td>
            <td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium">
                <div class="flex items-center space-x-2">
                    <button onclick="viewSupplier('${supplier.id}')" class="text-blue-600 hover:text-blue-900 transition-colors duration-200" title="View Details">
                        <i class="fas fa-eye text-xs"></i>
                    </button>
                    <button onclick="editSupplier('${supplier.id}')" class="text-indigo-600 hover:text-indigo-900 transition-colors duration-200" title="Edit">
                        <i class="fas fa-edit text-xs"></i>
                    </button>
                    <button onclick="deleteSupplier('${supplier.id}')" class="text-red-600 hover:text-red-900 transition-colors duration-200" title="Delete">
                        <i class="fas fa-trash text-xs"></i>
                    </button>
                </div>
            </td>
        </tr>
    `).join('');
}

function updateSupplierStats(stats) {
    document.getElementById('total-suppliers').textContent = stats.total || 0;
    document.getElementById('active-suppliers').textContent = stats.active || 0;
    document.getElementById('supplied-products').textContent = stats.products || 0;
    document.getElementById('total-value').textContent = `UGX ${(stats.total_value || 0).toLocaleString()}`;
}

function exportSuppliers() {
    showToast('Export functionality coming soon!', 'info');
}

function viewSupplier(id) {
    // Fetch supplier details
    fetch(`/api/suppliers/${id}`, {
        method: 'GET',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to fetch supplier details');
    })
    .then(supplier => {
        // Populate the view modal
        document.getElementById('view-supplier-name').textContent = supplier.name || 'N/A';
        document.getElementById('view-supplier-contact').textContent = supplier.contact_person || 'No contact person';
        document.getElementById('view-supplier-phone').textContent = supplier.phone || 'N/A';
        document.getElementById('view-supplier-email').textContent = supplier.email || 'N/A';
        document.getElementById('view-supplier-address').textContent = supplier.address || 'N/A';
        // Product count will be updated after loading products
        document.getElementById('view-supplier-products').textContent = '...';
        document.getElementById('view-supplier-products-count').textContent = 'Loading...';
        document.getElementById('view-supplier-last-order').textContent = supplier.last_order_date ? new Date(supplier.last_order_date).toLocaleDateString() : 'Never';
        document.getElementById('view-supplier-total-orders').textContent = supplier.total_orders || 0;

        // Account details
        document.getElementById('view-supplier-created').textContent = supplier.created_at ? new Date(supplier.created_at).toLocaleDateString() : 'Unknown';
        document.getElementById('view-supplier-updated').textContent = supplier.updated_at ? new Date(supplier.updated_at).toLocaleDateString() : 'Unknown';

        // Status
        const statusElement = document.getElementById('view-supplier-status');
        const isActive = supplier.is_active;
        statusElement.innerHTML = `
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                <i class="fas fa-circle text-xs mr-1"></i>
                ${isActive ? 'Active' : 'Inactive'}
            </span>
        `;

        // Notes
        const notesElement = document.getElementById('view-supplier-notes');
        if (supplier.notes && supplier.notes.trim()) {
            notesElement.textContent = supplier.notes;
        } else {
            notesElement.textContent = 'No additional notes available.';
        }

        // Load supplier products
        loadSupplierProducts(supplier.name);

        // Store supplier ID for edit button
        document.getElementById('view-supplier-modal').setAttribute('data-supplier-id', id);

        // Show the modal
        document.getElementById('view-supplier-modal').classList.remove('hidden');
    })
    .catch(error => {
        console.error('Error fetching supplier:', error);
        showToast('Failed to load supplier details', 'error');
    });
}

function closeViewSupplierModal() {
    document.getElementById('view-supplier-modal').classList.add('hidden');
}

function editSupplierFromView() {
    const supplierId = document.getElementById('view-supplier-modal').getAttribute('data-supplier-id');
    closeViewSupplierModal();
    editSupplier(supplierId);
}

// Load supplier products
function loadSupplierProducts(supplierName) {
    const productsList = document.getElementById('view-supplier-products-list');
    productsList.innerHTML = '<div class="text-sm text-purple-700 text-center py-4">Loading products...</div>';

    const apiUrl = `/api/products/?supplier=${encodeURIComponent(supplierName)}&size=1000`;
    console.log('Loading products for supplier:', supplierName);
    console.log('API URL:', apiUrl);

    // Fetch products for this specific supplier only
    fetch(apiUrl, {
        method: 'GET',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        console.error('API Response Status:', response.status, response.statusText);
        throw new Error(`Failed to fetch supplier products: ${response.status} ${response.statusText}`);
    })
    .then(data => {
        const products = data.products || [];

        // Update the product count in the stats card
        document.getElementById('view-supplier-products').textContent = products.length;
        document.getElementById('view-supplier-products-count').textContent = `${products.length} products`;

        if (products.length === 0) {
            productsList.innerHTML = `
                <div class="text-sm text-purple-600 text-center py-4">
                    <i class="fas fa-box-open text-purple-400 text-2xl mb-2"></i>
                    <div>No products found for supplier "${supplierName}"</div>
                    <div class="text-xs text-purple-500 mt-1">This supplier hasn't supplied any products yet, or products may be associated with a different supplier name.</div>
                </div>
            `;
            return;
        }

        // Display products
        productsList.innerHTML = products.map(product => `
            <div class="bg-white rounded-lg p-3 border border-purple-200 hover:border-purple-300 transition-colors duration-200">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="font-medium text-gray-900 text-sm">${product.name}</div>
                        <div class="text-xs text-gray-600 mt-1">
                            <span class="inline-flex items-center">
                                <i class="fas fa-tag text-gray-400 mr-1"></i>
                                SKU: ${product.sku || 'N/A'}
                            </span>
                            <span class="ml-3 inline-flex items-center">
                                <i class="fas fa-boxes text-gray-400 mr-1"></i>
                                Stock: ${product.stock_quantity || 0}
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-purple-900">
                            UGX ${(product.price || 0).toLocaleString()}
                        </div>
                        <div class="text-xs text-gray-500">
                            ${product.category || 'Uncategorized'}
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    })
    .catch(error => {
        console.error('Error loading supplier products:', error);
        console.error('Supplier name:', supplierName);
        console.error('API URL:', apiUrl);
        productsList.innerHTML = `
            <div class="text-sm text-red-600 text-center py-4">
                <i class="fas fa-exclamation-triangle text-red-400 text-xl mb-2"></i>
                <div>Failed to load products</div>
                <div class="text-xs text-red-500 mt-1">Check browser console for details</div>
            </div>
        `;
    });
}

async function editSupplier(id) {
    try {
        const response = await fetch(`/api/suppliers/${id}`, {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const supplier = await response.json();

            // Populate the edit form
            document.getElementById('edit-supplier-id').value = supplier.id;
            document.getElementById('edit-name').value = supplier.name || '';
            document.getElementById('edit-contact-person').value = supplier.contact_person || '';
            document.getElementById('edit-phone').value = supplier.phone || '';
            document.getElementById('edit-email').value = supplier.email || '';
            document.getElementById('edit-address').value = supplier.address || '';
            document.getElementById('edit-notes').value = supplier.notes || '';
            document.getElementById('edit-is-active').checked = supplier.is_active !== false;

            // Populate header information
            const createdDate = supplier.created_at ? new Date(supplier.created_at).toLocaleDateString() : 'Unknown';
            document.getElementById('edit-supplier-info').textContent =
                `Created on ${createdDate}  Contact: ${supplier.contact_person || 'Not specified'}`;
            document.getElementById('edit-supplier-product-count').textContent = supplier.products_count || 0;

            // Show edit modal
            openEditSupplierModal();
        } else {
            showToast('Failed to load supplier details', 'error');
        }
    } catch (error) {
        console.error('Error loading supplier:', error);
        showToast('Failed to load supplier details', 'error');
    }
}



async function deleteSupplier(id) {
    // First get supplier details to show in modal
    try {
        const response = await fetch(`/api/suppliers/${id}`, {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const supplier = await response.json();

            // Store supplier data for deletion
            window.deleteSupplierData = {
                id: id,
                supplier: supplier
            };

            // Populate modal with supplier information
            document.getElementById('delete-supplier-name').textContent = supplier.name || 'Unknown';
            document.getElementById('delete-supplier-contact').textContent = supplier.contact_person || 'Not specified';
            document.getElementById('delete-supplier-products').textContent = supplier.products_count || 0;

            // Show the delete modal
            openDeleteSupplierModal();
        } else {
            showToast('Failed to load supplier details', 'error');
        }
    } catch (error) {
        console.error('Error getting supplier details:', error);
        showToast('Failed to load supplier details', 'error');
    }
}

async function confirmDeleteSupplier() {
    if (!window.deleteSupplierData) {
        showToast('No supplier selected for deletion', 'error');
        return;
    }

    const { id, supplier } = window.deleteSupplierData;

    // Show loading state
    const deleteButton = document.querySelector('#delete-supplier-modal button[onclick="confirmDeleteSupplier()"]');
    const originalText = deleteButton.innerHTML;
    deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Deleting...';
    deleteButton.disabled = true;

    try {
        const response = await fetch(`/api/suppliers/${id}`, {
            method: 'DELETE',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const result = await response.json();
            showToast(result.message || 'Supplier deleted successfully!', 'success');
            closeDeleteSupplierModal();
            loadSuppliers();
        } else {
            const error = await response.json();
            showToast(error.detail || 'Failed to delete supplier', 'error');
        }
    } catch (error) {
        console.error('Error deleting supplier:', error);
        showToast('Failed to delete supplier', 'error');
    } finally {
        // Restore button state
        deleteButton.innerHTML = originalText;
        deleteButton.disabled = false;
    }
}



// Search functionality
document.getElementById('search-suppliers').addEventListener('input', function(e) {
    const searchTerm = e.target.value;
    const statusFilter = document.getElementById('status-filter').value;
    loadSuppliers(1, searchTerm, statusFilter);
});

document.getElementById('status-filter').addEventListener('change', function(e) {
    const statusFilter = e.target.value;
    const searchTerm = document.getElementById('search-suppliers').value;
    loadSuppliers(1, searchTerm, statusFilter);
});

// Update loadSuppliers function to accept search parameters
function loadSuppliers(page = 1, search = '', status = '') {
    const params = new URLSearchParams({
        page: page,
        size: 10
    });

    if (search) params.append('search', search);
    if (status) params.append('status', status);

    // Load suppliers from the API
    fetch(`/api/suppliers/?${params}`, {
        method: 'GET',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to load suppliers');
    })
    .then(data => {
        displaySuppliers(data.suppliers || []);
        updateSupplierStats(data.stats || {});
        showToast(`Loaded ${data.suppliers?.length || 0} suppliers`, 'success');
    })
    .catch(error => {
        console.error('Error loading suppliers:', error);
        showToast('Failed to load suppliers', 'error');
    });
}

// Sync supplier products
function syncSupplierProducts() {
    if (!confirm('This will sync all existing products with their suppliers. Continue?')) {
        return;
    }

    showToast('Syncing supplier products...', 'info');

    fetch('/api/suppliers/sync-products', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        credentials: 'include'
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Failed to sync supplier products');
    })
    .then(data => {
        showToast(data.message, 'success');
        loadSuppliers(); // Reload the suppliers table
    })
    .catch(error => {
        console.error('Error syncing supplier products:', error);
        showToast('Failed to sync supplier products', 'error');
    });
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadSuppliers();
});
</script>
{% endblock %}
