<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Inventory Management System{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¦</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- ApexCharts Library -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js"></script>
    <style>
        .pos-hidden {
            display: none !important;
        }

        /* Force white text for active navigation items */
        nav a.bg-gradient-to-r.from-blue-500.to-indigo-600 {
            color: white !important;
        }

        nav a.bg-gradient-to-r.from-blue-500.to-indigo-600 * {
            color: white !important;
        }

        /* Ensure icons in active nav items are white */
        nav a.bg-gradient-to-r.from-blue-500.to-indigo-600 i {
            color: white !important;
        }

        /* Override any conflicting text colors */
        .text-white {
            color: white !important;
        }

        /* Specific override for navigation active state */
        .bg-gradient-to-r.from-blue-500.to-indigo-600.text-white {
            color: white !important;
        }

        .bg-gradient-to-r.from-blue-500.to-indigo-600.text-white i {
            color: white !important;
        }

        /* Additional specificity for navigation text */
        .bg-gradient-to-r.from-blue-500.to-indigo-600 span,
        .bg-gradient-to-r.from-blue-500.to-indigo-600 div {
            color: white !important;
        }

        /* Custom scrollbar styles for sidebar navigation */
        .scrollbar-thin {
            scrollbar-width: thin;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Hide scrollbar on mobile */
        @media (max-width: 768px) {
            .scrollbar-thin {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .scrollbar-thin::-webkit-scrollbar {
                display: none;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' },
                        },
                        bounceIn: {
                            '0%': { opacity: '0', transform: 'scale(0.3)' },
                            '50%': { opacity: '1', transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full">
    <!-- Content block that adapts to authentication status -->
    {% if user %}
    <!-- Sidebar Layout for authenticated users -->
    <div class="flex h-screen bg-gray-50" x-data="{ sidebarOpen: false }">
        <!-- Desktop Sidebar -->
        <div class="hidden md:flex md:w-56 md:flex-col">
            <div class="flex flex-col h-full bg-white border-r border-gray-200 shadow-sm">
                <!-- Logo - Fixed at top -->
                <div class="flex items-center flex-shrink-0 px-3 pt-3 pb-3">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
                            <i class="fas fa-boxes text-white text-sm"></i>
                        </div>
                        <div class="ml-2">
                            <h1 class="text-lg font-bold text-gray-900">Inventory</h1>
                            <p class="text-xs text-gray-500">Management System</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation - Scrollable area -->
                <nav class="flex-1 px-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
                    <div class="space-y-1 pb-4">
                    {% if user and user.role != 'cashier' %}
                    <a href="/dashboard" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/dashboard') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/dashboard') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-tachometer-alt text-xs {% if request.url.path.startswith('/dashboard') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Dashboard
                    </a>
                    {% endif %}

                    <a href="/products" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/products') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/products') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-box text-xs {% if request.url.path.startswith('/products') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Products
                    </a>

                    {% if user and user.role != 'cashier' %}
                    <a href="/categories" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/categories') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/categories') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-tags text-xs {% if request.url.path.startswith('/categories') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Categories
                    </a>
                    {% endif %}

                    {% if user and user.role != 'cashier' %}
                    <a href="/scents" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/scents') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/scents') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-spray-can text-xs {% if request.url.path.startswith('/scents') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Scents
                    </a>
                    {% endif %}
                    {% if user and (user.role == 'admin' or user.role == 'manager') %}
                    <a href="/suppliers" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/suppliers') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/suppliers') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-truck text-xs {% if request.url.path.startswith('/suppliers') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Suppliers
                    </a>
                    {% endif %}
                    {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            
                    <a href="/expenses" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/expenses') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/expenses') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-receipt text-xs {% if request.url.path.startswith('/expenses') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Expenses
                    </a>
                    {% endif %}
                    <a href="/customers" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/customers') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/customers') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-users text-xs {% if request.url.path.startswith('/customers') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Clients
                    </a>

                    {% if user and (user.role == 'admin' or user.role == 'manager') %}
                    <a href="/installments" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/installments') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/installments') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-credit-card text-xs {% if request.url.path.startswith('/installments') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Installments
                    </a>
                    {% endif %}

                    <a href="/pos" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/pos') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/pos') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-cash-register text-xs {% if request.url.path.startswith('/pos') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Point of Sale
                    </a>

                    <a href="/orders" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/orders') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/orders') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-shopping-cart text-xs {% if request.url.path.startswith('/orders') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Orders
                    </a>
                    
                    <a href="/sales" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/sales') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/sales') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-chart-bar text-xs {% if request.url.path.startswith('/sales') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Sales
                    </a>
                     {% if user and (user.role == 'admin' or user.role == 'manager') %}
                    <a href="/reports" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/reports') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                        <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/reports') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                            <i class="fas fa-chart-bar text-xs {% if request.url.path.startswith('/reports') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                        </div>
                        Reports
                    </a>
                    {% endif %}

                        {% if user and (user.role == 'admin' or user.role == 'manager') %}
                        <a href="/users" class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/users') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                            <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/users') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                <i class="fas fa-user-tie text-xs {% if request.url.path.startswith('/users') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                            </div>
                            Staff Management
                        </a>
                        {% endif %}
                    </div>
                </nav>

                <!-- User Profile - Fixed at bottom -->
                <div class="flex-shrink-0 border-t border-gray-200 p-3">
                    <div class="flex-shrink-0 w-full group block" x-data="{ open: false }">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-md">
                                <span class="text-white text-xs font-medium">{{ user.full_name[0].upper() }}</span>
                            </div>
                            <div class="ml-2 flex-1">
                                <p class="text-xs font-medium text-gray-900">{{ user.full_name }}</p>
                                <p class="text-xs text-gray-500 capitalize">{{ user.role.replace('_', ' ') }}</p>
                            </div>
                            <div class="relative">
                                <button @click="open = !open"
                                        class="ml-2 flex-shrink-0 p-1.5 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200">
                                    <i class="fas fa-ellipsis-v text-xs"></i>
                                </button>
                                <div x-show="open"
                                     @click.away="open = false"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-150"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     class="absolute bottom-full right-0 mb-2 w-44 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50">
                                    <div class="px-3 py-2 text-xs text-gray-500 border-b border-gray-100">
                                        {{ user.email }}
                                    </div>
                                    <div class="px-3 py-2 text-xs text-gray-500 border-b border-gray-100">
                                        <i class="fas fa-clock mr-1"></i><span id="user-profile-time">--:--:--</span>
                                    </div>
                                    <a href="/auth/logout"
                                       class="flex items-center px-3 py-2 text-xs text-gray-700 hover:bg-red-50 hover:text-red-700 transition-colors duration-200">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Sign out
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Header -->
        <div class="md:hidden">
            <!-- Mobile menu button -->
            <div class="fixed top-0 left-0 right-0 z-40 flex items-center justify-between h-14 px-3 bg-white border-b border-gray-200 shadow-sm">
                <button @click="sidebarOpen = true"
                        class="p-1.5 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200">
                    <i class="fas fa-bars text-sm"></i>
                </button>
                <div class="flex items-center">
                    <div class="w-7 h-7 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-2">
                        <i class="fas fa-boxes text-white text-xs"></i>
                    </div>
                    <h1 class="text-base font-bold text-gray-900">Inventory</h1>
                </div>
                <!-- User Avatar -->
                <div class="w-7 h-7 bg-blue-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-xs font-medium">{{ user.full_name[0].upper() }}</span>
                </div>
            </div>

            <!-- Mobile sidebar overlay -->
            <div x-show="sidebarOpen"
                 class="fixed inset-0 z-50 flex"
                 x-transition:enter="transition-opacity ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="transition-opacity ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0">

                <!-- Backdrop -->
                <div @click="sidebarOpen = false"
                     class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>

                <!-- Sidebar -->
                <div class="relative flex-1 flex flex-col max-w-xs w-full bg-white shadow-2xl"
                     x-transition:enter="transition ease-out duration-300 transform"
                     x-transition:enter-start="-translate-x-full"
                     x-transition:enter-end="translate-x-0"
                     x-transition:leave="transition ease-in duration-200 transform"
                     x-transition:leave-start="translate-x-0"
                     x-transition:leave-end="-translate-x-full">

                    <!-- Close button -->
                    <div class="absolute top-0 right-0 -mr-12 pt-4">
                        <button @click="sidebarOpen = false"
                                class="ml-1 flex items-center justify-center h-10 w-10 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 transition-all duration-200">
                            <i class="fas fa-times text-white text-lg"></i>
                        </button>
                    </div>
                    <!-- Sidebar Header -->
                    <div class="flex items-center justify-center h-14 px-3 bg-gradient-to-r from-blue-500 to-indigo-600">
                        <div class="flex items-center">
                            <div class="w-7 h-7 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-2">
                                <i class="fas fa-boxes text-white text-sm"></i>
                            </div>
                            <div>
                                <h1 class="text-lg font-bold text-white">Inventory</h1>
                                <p class="text-xs text-blue-100">Management System</p>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar Content -->
                    <div class="flex-1 h-0 pt-4 pb-3 overflow-y-auto">
                        <nav class="px-3 space-y-1">
                            {% if user and user.role != 'cashier' %}
                            <a href="/dashboard" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/dashboard') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/dashboard') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-tachometer-alt text-xs {% if request.url.path.startswith('/dashboard') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Dashboard
                            </a>
                            {% endif %}
                            <a href="/products" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/products') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/products') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-box text-xs {% if request.url.path.startswith('/products') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Products
                            </a>
                            {% if user and user.role != 'cashier' %}
                            <a href="/categories" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/categories') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/categories') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-tags text-xs {% if request.url.path.startswith('/categories') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Categories
                            </a>
                            {% endif %}
                            {% if user and user.role != 'cashier' %}
                            <a href="/scents" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/scents') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/scents') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-spray-can text-xs {% if request.url.path.startswith('/scents') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Scents
                            </a>
                            {% endif %}
                             {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/suppliers" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/suppliers') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/suppliers') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-truck text-xs {% if request.url.path.startswith('/suppliers') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Suppliers
                            </a>
                            {% endif %}
                            {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/stock" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/stock') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/stock') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-boxes-stacked text-xs {% if request.url.path.startswith('/stock') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Stock
                            </a>
                            {% endif %}
                            {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/expenses" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/expenses') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/expenses') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-receipt text-xs {% if request.url.path.startswith('/expenses') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Expenses
                            </a>
                            {% endif %}
                            <a href="/customers" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/customers') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/customers') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-users text-xs {% if request.url.path.startswith('/customers') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Clients
                            </a>
                            {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/installments" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/installments') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/installments') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-credit-card text-xs {% if request.url.path.startswith('/installments') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Installments
                            </a>
                            {% endif %}
                            <a href="/pos" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/pos') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/pos') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-cash-register text-xs {% if request.url.path.startswith('/pos') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Point of Sale
                            </a>
                            <a href="/orders" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/orders') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/orders') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-shopping-cart text-xs {% if request.url.path.startswith('/orders') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Orders
                            </a>
                            <a href="/sales" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/sales') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/sales') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-chart-bar text-xs {% if request.url.path.startswith('/sales') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Sales
                            </a>
                            {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/reports" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/reports') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/reports') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-chart-bar text-xs {% if request.url.path.startswith('/reports') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Reports
                            </a>
                            {% endif %}
                            {% if user and (user.role == 'admin' or user.role == 'manager') %}
                            <a href="/users" @click="sidebarOpen = false"
                               class="group flex items-center px-2 py-2 text-sm font-medium rounded-lg transition-all duration-200 {% if request.url.path.startswith('/users') %}text-white bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md{% else %}text-gray-700 hover:bg-blue-50 hover:text-blue-700{% endif %}">
                                <div class="w-7 h-7 rounded-md flex items-center justify-center mr-2 transition-colors duration-200 {% if request.url.path.startswith('/users') %}bg-white bg-opacity-20{% else %}bg-gray-100 group-hover:bg-blue-100{% endif %}">
                                    <i class="fas fa-user-tie text-xs {% if request.url.path.startswith('/users') %}text-white{% else %}text-gray-500 group-hover:text-blue-600{% endif %}"></i>
                                </div>
                                Staff Management
                            </a>
                            {% endif %}
                        </nav>
                    </div>
                    <!-- User Profile Section -->
                    <div class="flex-shrink-0 border-t border-gray-200 p-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-md">
                                    <span class="text-white text-xs font-medium">{{ user.full_name[0].upper() }}</span>
                                </div>
                                <div class="ml-2">
                                    <p class="text-xs font-medium text-gray-900">{{ user.full_name }}</p>
                                    <p class="text-xs text-gray-500 capitalize">{{ user.role.replace('_', ' ') }}</p>
                                </div>
                            </div>
                            <a href="/auth/logout"
                               class="p-1.5 rounded-md text-gray-400 hover:text-red-600 hover:bg-red-50 transition-all duration-200"
                               title="Sign out">
                                <i class="fas fa-sign-out-alt text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main content area -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Page content with flex layout for sticky footer -->
            <main class="flex-1 relative overflow-y-auto focus:outline-none flex flex-col">
                <!-- Mobile padding top for fixed header -->
                <div class="pt-14 md:pt-0 flex-1">
                    <div class="py-4">
                        <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6">
                            <div class="content-wrapper min-h-full">
                                <!-- Content for authenticated users -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer for authenticated users - always at bottom -->
                <footer class="bg-white border-t border-gray-200 mt-auto">
                    <div class="max-w-7xl mx-auto py-4 px-3 sm:px-4 md:px-6">
                        <div class="text-center">
                            <p class="text-xs text-gray-500">
                                Â© 2024 <span class="font-semibold text-gray-600">Inventory Management System</span>. All rights reserved.
                            </p>
                        </div>
                    </div>
                </footer>
            </main>
        </div>
    </div>
    {% endif %}

    {% if not user %}
    <!-- Simple layout for unauthenticated users -->
    <div class="min-h-screen bg-gray-50">
        <div class="content-wrapper">
            <!-- Content for unauthenticated users -->
        </div>
    </div>
    {% endif %}

    <!-- Single content block that will be moved to the appropriate wrapper -->
    <div style="display: none;" id="content-source">
        {% block content %}{% endblock %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const contentSource = document.getElementById('content-source');
            const contentWrapper = document.querySelector('.content-wrapper');

            if (contentSource && contentWrapper) {
                // Move all children from content-source to content-wrapper
                while (contentSource.firstChild) {
                    contentWrapper.appendChild(contentSource.firstChild);
                }
                // Remove the hidden source container
                contentSource.remove();
            }
        });
    </script>



    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgGradient = type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' :
                              type === 'error' ? 'bg-gradient-to-r from-red-500 to-red-600' :
                              'bg-gradient-to-r from-blue-500 to-indigo-600';
            const icon = type === 'success' ? 'fas fa-check-circle' :
                        type === 'error' ? 'fas fa-exclamation-circle' :
                        'fas fa-info-circle';

            toast.className = `${bgGradient} text-white px-4 py-3 rounded-xl shadow-lg transform transition-all duration-300 translate-x-full hover:shadow-xl`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-white bg-opacity-20 rounded-md flex items-center justify-center mr-2">
                        <i class="${icon} text-white text-xs"></i>
                    </div>
                    <span class="font-medium text-sm">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 w-5 h-5 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-md flex items-center justify-center text-white transition-all duration-200">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `;
            document.getElementById('toast-container').appendChild(toast);

            // Animate in
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);

            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Check for URL parameters to show messages
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('registered') === 'true') {
            showToast('Registration successful! Please log in.', 'success');
        }

        // Set active navigation item - preserve server-side gradient styling
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('nav a[href]');

            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (currentPath.startsWith(href) && href !== '/') {
                    // Check if this link already has the gradient background (server-side active state)
                    const hasGradient = link.classList.contains('bg-gradient-to-r') &&
                                       link.classList.contains('from-blue-500') &&
                                       link.classList.contains('to-indigo-600');

                    if (hasGradient) {
                        // Preserve gradient styling and ensure white text
                        link.classList.add('text-white');
                        link.classList.remove('text-gray-600', 'text-gray-700', 'text-gray-900');

                        const icon = link.querySelector('i');
                        if (icon) {
                            icon.classList.add('text-white');
                            icon.classList.remove('text-gray-500', 'text-gray-600', 'text-gray-900', 'text-gray-400');
                        }
                    } else {
                        // Only apply fallback styling if no gradient is present
                        // Remove active classes from all other links first
                        navLinks.forEach(l => {
                            if (!l.classList.contains('bg-gradient-to-r')) {
                                l.classList.remove('text-gray-900', 'bg-gray-100');
                                l.classList.add('text-gray-600');
                                const icon = l.querySelector('i');
                                if (icon) {
                                    icon.classList.remove('text-gray-500');
                                    icon.classList.add('text-gray-400');
                                }
                            }
                        });

                        // Add fallback active classes to current link
                        link.classList.remove('text-gray-600');
                        link.classList.add('text-gray-900', 'bg-gray-100');
                        const icon = link.querySelector('i');
                        if (icon) {
                            icon.classList.remove('text-gray-400');
                            icon.classList.add('text-gray-500');
                        }
                    }
                }
            });
        });

        // Mobile sidebar enhancements
        document.addEventListener('DOMContentLoaded', function() {
            // Add touch support for better mobile experience
            const sidebar = document.querySelector('[x-data*="sidebarOpen"]');
            if (sidebar) {
                // Close sidebar when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    const sidebarElement = document.querySelector('.fixed.inset-0.z-50');
                    const menuButton = document.querySelector('[\\@click="sidebarOpen = true"]');

                    if (sidebarElement && !sidebarElement.contains(e.target) && !menuButton.contains(e.target)) {
                        // Trigger Alpine.js to close sidebar
                        if (window.Alpine) {
                            const component = Alpine.$data(sidebar);
                            if (component && component.sidebarOpen) {
                                component.sidebarOpen = false;
                            }
                        }
                    }
                });

                // Add swipe to close functionality
                let startX = 0;
                let currentX = 0;
                let isDragging = false;

                const sidebarContent = document.querySelector('.max-w-xs.w-full.bg-white');
                if (sidebarContent) {
                    sidebarContent.addEventListener('touchstart', function(e) {
                        startX = e.touches[0].clientX;
                        isDragging = true;
                    });

                    sidebarContent.addEventListener('touchmove', function(e) {
                        if (!isDragging) return;
                        currentX = e.touches[0].clientX;
                        const diffX = startX - currentX;

                        if (diffX > 0) {
                            sidebarContent.style.transform = `translateX(-${diffX}px)`;
                        }
                    });

                    sidebarContent.addEventListener('touchend', function(e) {
                        if (!isDragging) return;
                        isDragging = false;

                        const diffX = startX - currentX;
                        if (diffX > 100) { // Swipe threshold
                            if (window.Alpine) {
                                const component = Alpine.$data(sidebar);
                                if (component) {
                                    component.sidebarOpen = false;
                                }
                            }
                        }

                        sidebarContent.style.transform = '';
                    });
                }
            }

            // Add loading animation to cards
            const cards = document.querySelectorAll('.transform.hover\\:-translate-y-1');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('animate-fade-in');
            });

            // Update user profile time
            function updateUserProfileTime() {
                const timeElement = document.getElementById('user-profile-time');
                if (timeElement) {
                    const now = new Date();
                    const kampalaTime = now.toLocaleTimeString('en-US', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        timeZone: 'Africa/Kampala'
                    });
                    timeElement.textContent = kampalaTime;
                }
            }

            // Update time immediately and then every second
            updateUserProfileTime();
            setInterval(updateUserProfileTime, 1000);
        });
    </script>
</body>
</html>